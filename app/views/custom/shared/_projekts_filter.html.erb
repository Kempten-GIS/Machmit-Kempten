<% projekts.each do |projekt| %>
  <% toggle_projekt = ( @selected_parent_projekt && (projekt.id == @selected_parent_projekt.id || (projekt.children.ids & @selected_parent_projekt.children.ids).any? ) ) ? true : false %>
  <% label_class =  ( @selected_parent_projekt && @selected_projekts_ids && (projekt.id == @selected_parent_projekt.id || projekt.id.to_s.in?(@selected_projekts_ids)) ) ? 'label-selected' : 'label_regular' %>
  <% checkbox_checked = @selected_parent_projekt && @selected_projekts_ids && projekt.id.to_s.in?(@selected_projekts_ids.push(@selected_parent_projekt.id.to_s))  %>
  <% projekt_color = projekt&.map_location&.pin_color || '#00cae9' %>

  <ul>
    <li class='' aria-expanded=<%= toggle_projekt %> >
      <%= label_tag dom_id(projekt), class: label_class do %>
        <%= check_box_tag dom_id(projekt), projekt.id, checkbox_checked, { class: 'js-filter-projekt' }  %>
        <%= projekt.name %>
        <span class="checkmark"></span>
        <span class="color-code" style="background-color: <%= projekt_color %>" ></span>
      <% end %>

      <% if projekt.children.any? %>
        <span class='js-icon-toggle-child-projekts toggle-arrow'></span>
      <% end %>
    </li>

    <% if projekt.children.any? %>
      <%= render partial: "shared/projekts_filter", locals: { projekts: projekt.children.with_order_number } %>
    <% end %>

  </ul>
<% end %>
